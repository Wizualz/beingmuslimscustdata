<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BeingMuslims — Register</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,700&family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#fbf7f0;
  --panel:#fffaf5;
  --gold:#B78A28;
  --gold-2:#D4AF37;
  --muted:#7a6f5f;
  --ink:#1b1b1b;
  --border-light: #e7e0d4;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{
  background: var(--bg); /* Fallback color */
  font-family:"Cairo",system-ui,-apple-system,Segoe UI,Roboto,Arial;
  color:var(--ink);
  display:flex;align-items:center;justify-content:center;padding:28px;
  
  /* UPDATED: Multiple background images */
  background-image: 
    /* Top Layer: Arabic Pattern (rgba(183, 138, 40, 0.03) = --gold at 3% opacity) */
    url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="rgba(183, 138, 40, 0.03)" d="M0 0h50v50H0zm50 50h50v50H50zM25 0h50v25H25zm0 75h50v25H25zm-25 25h25v-50H0zm75-50h25v-50H75zM0 50h25v-25H0zm75 25h25v-25H75zM50 0h25v25H50zM25 50h25v25H25zM50 75h25v25H50zM75 0h25v25H75zM0 75h25v25H0zM50 25h25v25H50zM25 25h25v25H25zM75 50h25v25H75z"/></svg>'),
    /* Bottom Layer: Gradient */
    linear-gradient(175deg, var(--bg) 0%, #ffffff 100%);
  
  background-size: 150px, auto; /* Size for pattern, default for gradient */
  background-repeat: repeat, no-repeat; /* Repeat pattern, don't repeat gradient */
}

.container{
  width:100%;
  max-width:1000px;
  margin: 20px auto;
  background: var(--panel);
  border-radius: 24px;
  border: 1px solid rgba(183,138,40,0.15);
  box-shadow: 0 25px 80px rgba(100, 70, 20, 0.12);
  display: grid;
  grid-template-columns: 1fr;
  overflow: hidden;
}

@media (min-width: 800px) {
  .container {
    grid-template-columns: 4fr 6fr; /* 40% brand, 60% form */
  }
}

.brand-panel {
  padding: 40px;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background-color: var(--bg);
  position: relative;
  border-bottom: 1px solid var(--border-light);
}
@media (min-width: 800px) {
  .brand-panel {
    border-bottom: 0;
    border-right: 1px solid var(--border-light);
    padding: 48px;
  }
}

.brand-panel::before {
  content: "";
  position: absolute;
  inset: 0;
  opacity: 0.04;
  background-image: url('data:image/svg+xml,<svg viewBox="0 0 600 600" xmlns="http://www.w3.org/2000/svg"><text x="50%" y="55%" text-anchor="middle" font-family="Playfair Display, serif" font-size="140" fill="%23B78A28">بِسْمِ</text></svg>');
  background-size: 300px;
  z-index: 1;
}

.brand-logo {
  width: 180px; /* Adjusted size */
  height: 180px; /* Adjusted size */
  object-fit: contain;
  display: block;
  /* REMOVED: border-radius, border, background, box-shadow */
  background: none; /* Make background transparent */
  border-radius: 0; /* No border radius */
  border: none; /* No border */
  box-shadow: none; /* No shadow */
  position: relative;
  z-index: 2;
  margin-bottom: 24px;
}

.brand-panel .headline {
  font-family:"Playfair Display",serif;
  font-size: 34px;
  margin: 0 0 8px;
  color:var(--gold);
  position: relative;
  z-index: 2;
}
.brand-panel .subtitle {
  font-size: 16px;
  color: var(--muted);
  margin: 0;
  max-width: 300px;
  line-height: 1.5;
  position: relative;
  z-index: 2;
}

.form-panel {
  padding: 40px;
  text-align: left;
  position: relative;
}
@media (min-width: 800px) {
  .form-panel {
    padding: 48px;
  }
}

.form-panel h2 {
  font-family:"Playfair Display",serif;
  font-size: 28px;
  margin: 0 0 24px;
  color: var(--ink);
  text-align: center; /* Centered the heading */
}

form{
  display:flex;flex-direction:column;
  gap: 18px;
  position: relative;
  z-index: 1;
}

label{
  font-size:14px;
  color:var(--muted);
  text-align:left;
  font-weight:700;
  margin-bottom: -10px;
}

input,select{
  padding:14px 16px;
  border-radius:10px;
  border: 1px solid var(--border-light);
  background:white;
  font-size:16px;
  font-family: "Cairo", system-ui, sans-serif;
  color:var(--ink);
  width: 100%;
  box-shadow: 0 3px 8px rgba(0,0,0,0.02) inset;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}
input::placeholder{color:#aaa}

input:focus, select:focus {
  outline: none;
  border-color: var(--gold);
  box-shadow: 0 0 0 3px rgba(183, 138, 40, 0.15);
}

.btn{
  margin-top:12px;
  padding:14px 16px;
  border-radius:12px;
  border:0;
  font-weight:700;
  font-size:17px;
  color:white;
  background:linear-gradient(90deg,var(--gold),var(--gold-2));
  cursor:pointer;
  box-shadow:0 12px 30px rgba(183,138,40,0.2);
  width: 100%;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 16px 35px rgba(183, 138, 40, 0.25);
}
.btn[disabled]{
  opacity:.6;
  cursor:wait;
  transform: none;
  box-shadow: 0 12px 30px rgba(183, 138, 40, 0.2);
}

.modal-backdrop{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.4);z-index:200; padding: 20px;}
.modal{width:92%;max-width:600px;background:white;padding:26px;border-radius:14px;text-align:center;box-shadow:0 40px 120px rgba(0,0,0,0.18)}
.modal h2{margin:0;font-family:"Playfair Display",serif;font-size:26px;color:var(--gold)}
.modal p{margin:12px 0 0;color:#444;font-size:16px}
.modal .ok{margin-top:18px;padding:12px 18px;border-radius:12px;border:0;background:linear-gradient(90deg,var(--gold),var(--gold-2));font-weight:800;color:white;cursor:pointer}
.toast{position:fixed;right:20px;bottom:20px;background:#111;color:#fff;padding:10px 12px;border-radius:10px;display:none;z-index:300}
</style>
</head>
<body>

<div class="container">
  
  <div class="brand-panel">
    <img src="https://cdn.shopify.com/s/files/1/0617/3255/2841/files/LOGO_57be401e-cab6-40fc-b299-eedabcaa3590.png?v=1763289698" alt="BeingMuslims logo" id="brandLogo" class="brand-logo">
    
    <div class="headline">Welcome to BeingMuslims</div>
    <p class="subtitle">Register to join our community and receive updates & offers.</p>
  </div>

  <div class="form-panel">
    
    <h2>WELCOME TO BEINGMUSLIMS FAMILY</h2>

    <form id="custForm">
      <label for="name">Customer Name</label>
      <input id="name" name="name" placeholder="e.g. Aisha bint Omar" required>

      <label for="phone">Phone Number</label>
      <input id="phone" name="phone" type="tel" placeholder="e.g. 9876543210" required>

      <label for="branch">Branch</label>
      <select id="branch" name="branch" required>
        <option value="">Select branch</option>
        <option>MUMBAI</option><option>DELHI</option><option>SURAT</option><option>PUNE</option>
        <option>AHMEDABAD</option><option>AURANGABAD</option><option>BELGAUM</option>
        <option>HYDERABAD</option><option>LUCKNOW</option><option>BHOPAL</option>
      </select>

      <button class="btn" id="saveBtn" type="submit">Save</button>
    </form>
  </div>

</div> 
<form id="fallback" action="https://script.google.com/macros/s/AKfycbx0YEHVo-jmc0NxlsoZoWRgAP6y04dtXs-al6PETPQ1vujsqfH-3m8k2ECkImcGxMSsvA/exec" method="post" target="hidden_iframe" style="display:none">
  <input name="name"><input name="phone"><input name="branch">
</form>
<iframe name="hidden_iframe" style="display:none"></iframe>

<div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true">
    <h2>Thank you, <span id="custName">Customer</span></h2>
    <p id="modalText">For submitting your details. <strong>InshaAllah</strong> you will get all offers & regular updates.</p>
    <button class="ok" id="okBtn">Done</button>
  </div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
(async function(){
  // Replace with your actual deployment URL if different
  const WEB_APP = "https://script.google.com/macros/s/AKfycbx0YEHVo-jmc0NxlsoZoWRgAP6y04dtXs-al6PETPQ1vujsqfH-3m8k2ECkImcGxMSsvA/exec";

  const form = document.getElementById('custForm');
  const fallback = document.getElementById('fallback');
  const iframe = document.querySelector('iframe[name="hidden_iframe"]');
  const saveBtn = document.getElementById('saveBtn');
  const nameEl = document.getElementById('name');
  const phoneEl = document.getElementById('phone');
  const branchEl = document.getElementById('branch');
  const modalBackdrop = document.getElementById('modalBackdrop');
  const custNameSpan = document.getElementById('custName');
  const okBtn = document.getElementById('okBtn');
  const toast = document.getElementById('toast');

  function showToast(msg, ok=true){
    toast.textContent = msg;
    toast.style.background = ok? '#111' : '#b91c1c';
    toast.style.display = 'block';
    setTimeout(()=> toast.style.display='none', 3000);
  }

  okBtn.onclick = ()=> { modalBackdrop.style.display = 'none'; modalBackdrop.setAttribute('aria-hidden','true'); };

  // auto-branch via ?branch=NAME
  const urlBranch = new URLSearchParams(window.location.search).get('branch');
  if (urlBranch) {
    let found=false;
    for (const opt of branchEl.options){ if(opt.value && opt.value.toLowerCase()===urlBranch.toLowerCase()){ opt.selected=true; found=true; break; } }
    if (!found){ const opt = document.createElement('option'); opt.value=urlBranch; opt.text=urlBranch; opt.selected=true; branchEl.appendChild(opt); }
    branchEl.disabled = true;
  }

  iframe.addEventListener('load', ()=> {
    console.log('Hidden iframe loaded (fallback).');
    showToast('Saved (fallback)', true);
  });

  form.addEventListener('submit', async function(e){
    e.preventDefault();
    const name = nameEl.value.trim();
    const phone = phoneEl.value.trim();
    const branch = branchEl.value.trim();
    if (!name || !phone || !branch){ showToast('Please fill all fields', false); return; }

    // show modal
    custNameSpan.textContent = name;
    modalBackdrop.style.display = 'flex';
    modalBackdrop.setAttribute('aria-hidden','false');
    saveBtn.disabled = true; saveBtn.textContent = 'Saving...';

    // Build URLSearchParams for form-encoded POST (Apps Script reads e.parameter)
    const params = new URLSearchParams();
    params.append('name', name);
    params.append('phone', phone);
    params.append('branch', branch);
    params.append('timestamp_client', new Date().toISOString());

    try{
      // Send as application/x-www-form-urlencoded
      const res = await fetch(WEB_APP, {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: params.toString(),
        cache: 'no-store'
      });

      // Many Apps Script responses will be opaque; treat 200 or OK as success
      if (res && (res.status === 200 || res.ok || res.type === 'opaque')) {
        console.log('Fetch OK', res);
        showToast('Saved successfully', true);
        setTimeout(()=> {
          saveBtn.disabled = false; saveBtn.textContent = 'Save';
          form.reset();
          if(urlBranch){ branchEl.value = urlBranch; branchEl.disabled = true; }
          modalBackdrop.style.display = 'none'; modalBackdrop.setAttribute('aria-hidden','true');
        }, 900);
        return;
      } else {
        console.warn('Fetch returned non-OK', res);
      }
    } catch (err){
      console.warn('Fetch error', err);
    }

    // If anything fails, fallback to hidden form POST (form-encoded)
    try{
      fallback.elements['name'].value = name;
      fallback.elements['phone'].value = phone;
      fallback.elements['branch'].value = branch;
      fallback.submit();
      // reset UI (iframe load handler will show toast)
      saveBtn.disabled = false; saveBtn.textContent = 'Save';
      form.reset();
      if(urlBranch){ branchEl.value = urlBranch; branchEl.disabled = true; }
    } catch (err){
      console.error('Fallback error', err);
      showToast('Save failed — check console', false);
      saveBtn.disabled = false; saveBtn.textContent = 'Save';
    }
  });

  // Logo load debug - JAVASCRIPT MESSAGE UPDATED
  const logoImg = document.getElementById('brandLogo');
  logoImg.addEventListener('error', ()=> { 
    console.warn('Logo failed to load from CDN.'); 
    showToast('Logo failed to load', false); 
  });
  logoImg.addEventListener('load', ()=> { 
    console.log('Logo loaded OK'); 
  });

})();
</script>
</body>
</html>
