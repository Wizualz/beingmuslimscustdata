<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Customer - Save to Google Sheet</title>
<style>
  :root{--bg:#f5f7fb;--card:#ffffff;--accent:#2563eb}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:#111}
  .wrap{max-width:520px;margin:40px auto;padding:20px}
  .card{background:var(--card);border-radius:12px;padding:22px;box-shadow:0 6px 30px rgba(16,24,40,.08)}
  h1{margin:0 0 8px;font-size:20px}
  p.sub{margin:0 0 18px;color:#475569;font-size:14px}
  label{display:block;font-weight:600;margin-top:12px;font-size:13px}
  input[type="text"], input[type="tel"], select{
    width:100%;padding:12px 10px;margin-top:8px;border:1px solid #e6eef6;border-radius:8px;box-sizing:border-box;font-size:15px
  }
  button{margin-top:16px;background:var(--accent);color:#fff;padding:12px 14px;border:none;border-radius:10px;font-weight:700;cursor:pointer;width:100%;font-size:15px}
  .msg{margin-top:12px;font-weight:600}
  .success{color:#059669}
  .error{color:#dc2626}
  .small{font-size:13px;color:#475569;margin-top:10px}
  footer{margin-top:16px;text-align:center;color:#64748b;font-size:13px}
  @media (max-width:420px){.wrap{margin:18px;padding:12px}.card{padding:16px}}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Customer Details</h1>
      <p class="sub">Name aur phone daalein. Branch agar URL se aayega toh woh auto-set ho jayega.</p>

      <form id="custForm" autocomplete="off">
        <label for="name">Name</label>
        <input id="name" name="name" type="text" placeholder="Full name" required />

        <label for="phone">Phone</label>
        <input id="phone" name="phone" type="tel" placeholder="eg. 9876543210" required pattern="[0-9+()\- ]{6,}" />

        <label for="branch">Branch</label>
        <select id="branch" name="branch" required>
          <option value="">-- Select branch --</option>
          <option>MUMBAI</option>
          <option>DELHI</option>
          <option>SURAT</option>
          <option>PUNE</option>
          <option>AHMEDABAD</option>
          <option>AURANGABAD</option>
          <option>BELGAUM</option>
          <option>HYDERABAD</option>
          <option>LUCKNOW</option>
          <option>BHOPAL</option>
        </select>

        <button type="submit">Save</button>
      </form>

      <div id="msg" class="msg" role="status" aria-live="polite"></div>
      <div class="small">Tip: Agar aap chahte ho branch-specific link use karna — use `...?branch=MUMBAI` in the URL.</div>
    </div>

    <footer>Made quick — submit will save to your Google Sheet</footer>
  </div>

<script>
/* ====== CONFIG: put your Apps Script Web App URL here (already filled) ====== */
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxPCvWE1Rp5CeBWLCoTrA_7qGyn0pkx2tpi1ztjuXdbJkINyb1vNu1pFzMMC0WArCma-A/exec";
/* ======================================================================= */

const form = document.getElementById('custForm');
const msgEl = document.getElementById('msg');
const branchEl = document.getElementById('branch');

function getQueryParam(name){
  return new URLSearchParams(window.location.search).get(name) || '';
}

// If branch param present -> set and disable dropdown (so staff can't change accidentally)
const branchParam = getQueryParam('branch').trim();
if(branchParam){
  // try to match option (case-insensitive). If not found, create and select.
  let found = false;
  for(const opt of branchEl.options){
    if(opt.value && opt.value.toLowerCase() === branchParam.toLowerCase()){
      opt.selected = true; found = true; break;
    }
  }
  if(!found){
    const opt = document.createElement('option');
    opt.value = branchParam;
    opt.text = branchParam;
    opt.selected = true;
    branchEl.appendChild(opt);
  }
  branchEl.disabled = true;
}

function showMessage(text, type){
  msgEl.textContent = text;
  msgEl.className = 'msg ' + (type === 'success' ? 'success' : 'error');
}

form.addEventListener('submit', async function(e){
  e.preventDefault();
  showMessage('', '');
  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const branch = document.getElementById('branch').value.trim();

  if(!name || !phone){
    showMessage('Name aur phone dono bharein.', 'error'); return;
  }

  // optional: simple phone normalization
  const phoneDigits = phone.replace(/[^\d+]/g,'');

  const payload = { name, phone: phoneDigits, branch };

  try{
    const res = await fetch(WEB_APP_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    // Try parse JSON safely
    let data = null;
    try{ data = await res.json(); } catch(err){ data = null; }
    if(res.ok && data && data.status === 'success'){
      showMessage('Saved — thank you!', 'success');
      form.reset();
      // reassign branch param if present
      if(branchParam){ branchEl.value = branchParam; branchEl.disabled = true; }
    } else {
      // show helpful message
      const serverMsg = data && data.message ? data.message : 'Server error or invalid response';
      showMessage('Error: ' + serverMsg, 'error');
      console.error('Server response', res.status, data);
    }
  } catch(err){
    showMessage('Network error: ' + err.message, 'error');
    console.error(err);
  }
});
</script>
</body>
</html>


